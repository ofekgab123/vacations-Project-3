{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ofekg\\\\OneDrive\\\\\\u05E9\\u05D5\\u05DC\\u05D7\\u05DF \\u05D4\\u05E2\\u05D1\\u05D5\\u05D3\\u05D4\\\\Project-3\\\\frontend\\\\src\\\\components\\\\edit-vacation\\\\edit-vacation.tsx\";\nimport React from 'react';\nimport './edit-vacation.css';\nimport { VacationModel } from '../../models/vacation-model';\nimport { Component } from 'react';\nimport { store } from \"../../redux/store\";\nimport { ActionType } from \"../../redux/action-type\";\nimport { PageNotFound } from '../page-not-found/page-not-found';\nimport TextField from '@material-ui/core/TextField';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport DateFnsUtils from '@date-io/date-fns';\nimport { MuiPickersUtilsProvider, KeyboardDatePicker } from '@material-ui/pickers';\nimport io from 'socket.io-client';\nexport class EditVacation extends Component {\n  constructor(props) {\n    super(props);\n    this.unsubscribeStore = void 0;\n    this.socket = io.connect(\"http://localhost:3001\");\n\n    this.componentWillUnmount = () => {\n      this.unsubscribeStore();\n    };\n\n    this.componentDidMount = () => {\n      const id = this.props.match.params.id;\n      fetch(`http://localhost:3001/api/vacations/${id}`).then(res => res.json()).then(vacation => {\n        vacation.fromDate = new Date(vacation.fromDate);\n        vacation.toDate = new Date(vacation.toDate);\n        this.setState({\n          vacation\n        });\n        this.setState({\n          imgToDisplay: vacation.image\n        });\n      }).catch(err => alert(err));\n    };\n\n    this.updateDestination = args => {\n      const input = args.target;\n      const destination = input.value;\n      const vacation = { ...this.state.vacation\n      };\n      input.id = '';\n      vacation.destination = destination;\n      this.setState({\n        vacation\n      });\n    };\n\n    this.updateDescription = args => {\n      const input = args.target;\n      const description = input.value;\n      const vacation = { ...this.state.vacation\n      };\n      vacation.description = description;\n      this.setState({\n        vacation\n      });\n    };\n\n    this.updateDepartingDate = (date, e) => {\n      const vacation = { ...this.state.vacation\n      };\n\n      if (date === null || date.toString() === 'Invalid Date') {\n        vacation.fromDate = null;\n        this.setState({\n          vacation\n        });\n        return;\n      }\n\n      vacation.fromDate = date;\n      this.setState({\n        vacation\n      });\n    };\n\n    this.updateReturningDate = (date, e) => {\n      const vacation = { ...this.state.vacation\n      };\n\n      if (date === null || date.toString() === 'Invalid Date') {\n        vacation.toDate = null;\n        this.setState({\n          vacation\n        });\n        return;\n      }\n\n      vacation.toDate = date;\n      this.setState({\n        vacation\n      });\n    };\n\n    this.updatePrice = args => {\n      const input = args.target;\n      const price = input.value;\n      const vacation = { ...this.state.vacation\n      };\n\n      if (price.length < 1 || price.length > 6 || isNaN(+price)) {\n        input.id = 'error';\n        vacation.price = undefined;\n        this.setState({\n          vacation\n        });\n        return;\n      }\n\n      input.id = '';\n      vacation.price = +price;\n      this.setState({\n        vacation\n      });\n    };\n\n    this.checkImage = event => {\n      const image = event.target.files[0];\n      this.setState({\n        newImage: image\n      });\n    };\n\n    this.checkForm = async () => {\n      const vacation = { ...this.state.vacation\n      }; // validation\n\n      if (vacation.destination.length < 3 || vacation.destination.length > 50) {\n        vacation.destination = null;\n        alert('fix destination input');\n        return;\n      }\n\n      if (vacation.description.length < 4 || vacation.description.length > 300) {\n        vacation.description = null;\n        alert('fix description input');\n        return;\n      }\n\n      if (vacation.fromDate > vacation.toDate) {\n        alert('Returning date cannot be before departing !');\n        return;\n      }\n\n      if (vacation.fromDate === vacation.toDate) {\n        alert('Departing date cant be the same as returning date');\n        return;\n      }\n\n      if (vacation.description === undefined || vacation.destination === undefined || vacation.fromDate === undefined || vacation.fromDate === null || vacation.toDate === undefined || vacation.toDate === null || vacation.price === undefined) {\n        alert('please fix all inputs / enter valid values .');\n        return;\n      }\n\n      this.sendForm();\n    };\n\n    this.sendForm = () => {\n      const vacation = { ...this.state.vacation\n      };\n      const formData = new FormData();\n      formData.append('image', this.state.newImage);\n      formData.append('vacation', JSON.stringify(vacation));\n      const options = {\n        method: \"PUT\",\n        headers: {\n          \"Authorization\": \"Bearer \" + localStorage.getItem('token')\n        },\n        body: formData\n      };\n      fetch('http://localhost:3001/api/vacations/update-vacation', options).then(res => res.json()).then(vacation => {\n        const action = {\n          type: ActionType.updateVacation,\n          payload: vacation\n        };\n        store.dispatch(action);\n        alert('vacation has been updated !');\n        this.props.history.push(\"/admin-panel\");\n        this.socket.emit(\"get-all-vacations\");\n      }).catch(err => alert(err));\n    };\n\n    this.state = {\n      imgToDisplay: '',\n      user: store.getState().user,\n      vacation: new VacationModel(),\n      newImage: ''\n    };\n    this.unsubscribeStore = store.subscribe(() => {\n      this.setState({\n        user: store.getState().user\n      });\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"editVacation\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, this.state.user.isAdmin ? React.createElement(\"form\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }, React.createElement(\"table\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }, React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }, \"destination :\")), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }, React.createElement(TextField, {\n      value: this.state.vacation.destination || '',\n      variant: \"filled\",\n      onChange: this.updateDestination,\n      helperText: \"Type between 3-50 characters\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190\n      },\n      __self: this\n    })), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }, \"description : \")), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, React.createElement(TextField, {\n      value: this.state.vacation.description || '',\n      multiline: true,\n      helperText: \"Type between 4-300 characters\",\n      onChange: this.updateDescription,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }))), React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }, \"Departing : \")), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }, React.createElement(MuiPickersUtilsProvider, {\n      utils: DateFnsUtils,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, React.createElement(Grid, {\n      container: true,\n      justify: \"space-around\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214\n      },\n      __self: this\n    }, React.createElement(KeyboardDatePicker, {\n      margin: \"normal\",\n      format: \"dd/MM/yyyy\",\n      value: this.state.vacation.fromDate,\n      onChange: this.updateDepartingDate,\n      KeyboardButtonProps: {\n        'aria-label': 'change date'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    })))), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    }, \"Returning : \")), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }, React.createElement(MuiPickersUtilsProvider, {\n      utils: DateFnsUtils,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }, React.createElement(Grid, {\n      container: true,\n      justify: \"space-around\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }, React.createElement(KeyboardDatePicker, {\n      margin: \"normal\",\n      format: \"dd/MM/yyyy\",\n      value: this.state.vacation.toDate,\n      onChange: this.updateReturningDate,\n      KeyboardButtonProps: {\n        'aria-label': 'change date'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }))))), React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }, \"Price : \")), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    }, React.createElement(TextField, {\n      label: \"price\",\n      value: this.state.vacation.price || '',\n      variant: \"filled\",\n      helperText: \"Type between 1-6 characters\",\n      onChange: this.updatePrice,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251\n      },\n      __self: this\n    })), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257\n      },\n      __self: this\n    }, \"Image : \")), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: `/assets/images/vacations/${this.state.imgToDisplay}`,\n      alt: \"old\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259\n      },\n      __self: this\n    }))), React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262\n      },\n      __self: this\n    }), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263\n      },\n      __self: this\n    }), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264\n      },\n      __self: this\n    }), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      accept: \"image/*\",\n      className: \"imageUplode\",\n      id: \"outlined-button-file\",\n      multiple: true,\n      type: \"file\",\n      name: \"imageToUplode\",\n      onChange: this.checkImage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266\n      },\n      __self: this\n    }), React.createElement(\"label\", {\n      htmlFor: \"outlined-button-file\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275\n      },\n      __self: this\n    }, React.createElement(Button, {\n      variant: \"outlined\",\n      component: \"span\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 276\n      },\n      __self: this\n    }, \"Upload new image\")))))), React.createElement(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284\n      },\n      __self: this\n    }), React.createElement(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      onClick: () => this.props.history.push(\"/admin-panel\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285\n      },\n      __self: this\n    }, \"Cancel\"), React.createElement(Button, {\n      variant: \"contained\",\n      color: \"secondary\",\n      onClick: this.checkForm,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288\n      },\n      __self: this\n    }, \"Update Vacation\")) : React.createElement(PageNotFound, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292\n      },\n      __self: this\n    }));\n  }\n\n}","map":{"version":3,"sources":["C:/Users/ofekg/OneDrive/שולחן העבודה/Project-3/frontend/src/components/edit-vacation/edit-vacation.tsx"],"names":["React","VacationModel","Component","store","ActionType","PageNotFound","TextField","Button","Grid","DateFnsUtils","MuiPickersUtilsProvider","KeyboardDatePicker","io","EditVacation","constructor","props","unsubscribeStore","socket","connect","componentWillUnmount","componentDidMount","id","match","params","fetch","then","res","json","vacation","fromDate","Date","toDate","setState","imgToDisplay","image","catch","err","alert","updateDestination","args","input","target","destination","value","state","updateDescription","description","updateDepartingDate","date","e","toString","updateReturningDate","updatePrice","price","length","isNaN","undefined","checkImage","event","files","newImage","checkForm","sendForm","formData","FormData","append","JSON","stringify","options","method","headers","localStorage","getItem","body","action","type","updateVacation","payload","dispatch","history","push","emit","user","getState","subscribe","render","isAdmin"],"mappings":"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","sourcesContent":["import React, { SyntheticEvent } from 'react';\r\nimport './edit-vacation.css';\r\nimport { VacationModel } from '../../models/vacation-model';\r\nimport { UserModel } from '../../models/user-model';\r\nimport { Component } from 'react';\r\nimport { store } from \"../../redux/store\";\r\nimport { Action } from \"../../redux/action\";\r\nimport { ActionType } from \"../../redux/action-type\";\r\nimport { Unsubscribe } from \"redux\";\r\nimport { PageNotFound } from '../page-not-found/page-not-found';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Button from '@material-ui/core/Button';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport DateFnsUtils from '@date-io/date-fns';\r\nimport {\r\n    MuiPickersUtilsProvider,\r\n    KeyboardDatePicker,\r\n} from '@material-ui/pickers';\r\nimport io from 'socket.io-client';\r\n\r\ninterface AddVacationState {\r\n    vacation: VacationModel;\r\n    user: UserModel;\r\n    imgToDisplay: string;\r\n    newImage: any;\r\n}\r\nexport class EditVacation extends Component<any, AddVacationState> {\r\n    private unsubscribeStore: Unsubscribe;\r\n    private socket = io.connect(\"http://localhost:3001\");\r\n    public constructor(props: any) {\r\n        super(props);\r\n        this.state = {\r\n            imgToDisplay: '',\r\n            user: store.getState().user,\r\n            vacation: new VacationModel(),\r\n            newImage: ''\r\n        }\r\n\r\n        this.unsubscribeStore = store.subscribe(() => {\r\n            this.setState({ user: store.getState().user });\r\n        });\r\n    }\r\n\r\n    public componentWillUnmount = () => {\r\n        this.unsubscribeStore();\r\n        \r\n    }\r\n\r\n    public componentDidMount = () => {\r\n        const id = this.props.match.params.id;\r\n        fetch(`http://localhost:3001/api/vacations/${id}`)\r\n            .then(res => res.json())\r\n            .then(vacation => {\r\n                vacation.fromDate = new Date(vacation.fromDate);\r\n                vacation.toDate = new Date(vacation.toDate);\r\n                this.setState({ vacation })\r\n                this.setState({ imgToDisplay: vacation.image });\r\n            })\r\n            .catch(err => alert(err));\r\n    }\r\n    private updateDestination = (args: SyntheticEvent) => {\r\n        const input = (args.target as HTMLSelectElement);\r\n        const destination = input.value;\r\n        const vacation = { ...this.state.vacation };\r\n        input.id = '';\r\n        vacation.destination = destination;\r\n        this.setState({ vacation });\r\n    }\r\n    private updateDescription = (args: SyntheticEvent) => {\r\n        const input = (args.target as HTMLSelectElement);\r\n        const description = input.value;\r\n        const vacation = { ...this.state.vacation };\r\n        vacation.description = description;\r\n        this.setState({ vacation });\r\n    }\r\n    private updateDepartingDate = (date: Date, e: any) => {\r\n        const vacation = { ...this.state.vacation };\r\n        if (date === null || date.toString() === 'Invalid Date') {\r\n            vacation.fromDate = null;\r\n            this.setState({ vacation });\r\n            return;\r\n        }\r\n        vacation.fromDate = date;\r\n        this.setState({ vacation });\r\n    }\r\n    private updateReturningDate = (date: Date, e: any) => {\r\n        const vacation = { ...this.state.vacation };\r\n        if (date === null || date.toString() === 'Invalid Date') {\r\n            vacation.toDate = null;\r\n            this.setState({ vacation });\r\n            return;\r\n        }\r\n        vacation.toDate = date;\r\n        this.setState({ vacation });\r\n    }\r\n    private updatePrice = (args: SyntheticEvent) => {\r\n        const input = (args.target as HTMLSelectElement);\r\n        const price = input.value;\r\n        const vacation = { ...this.state.vacation };\r\n        if (price.length < 1 || price.length > 6 || isNaN(+price)) {\r\n            input.id = 'error';\r\n            vacation.price = undefined;\r\n            this.setState({ vacation });\r\n            return;\r\n        }\r\n        input.id = '';\r\n        vacation.price = +price;\r\n        this.setState({ vacation });\r\n    }\r\n    private checkImage = (event: any) => {\r\n        const image = event.target.files[0];\r\n        this.setState({ newImage: image });\r\n    }\r\n\r\n\r\n    private checkForm = async () => {\r\n        const vacation = { ...this.state.vacation };\r\n        // validation\r\n        if (vacation.destination.length < 3 || vacation.destination.length > 50) {\r\n            vacation.destination = null;\r\n            alert('fix destination input');\r\n            return;\r\n        }\r\n        if (vacation.description.length < 4 || vacation.description.length > 300) {\r\n            vacation.description = null;\r\n            alert('fix description input');\r\n            return;\r\n        }\r\n        if (vacation.fromDate > vacation.toDate) {\r\n            alert('Returning date cannot be before departing !');\r\n            return;\r\n        }\r\n        if (vacation.fromDate === vacation.toDate) {\r\n            alert('Departing date cant be the same as returning date');\r\n            return;\r\n        }\r\n\r\n        if (vacation.description === undefined || vacation.destination === undefined ||\r\n            vacation.fromDate === undefined || vacation.fromDate === null ||\r\n            vacation.toDate === undefined || vacation.toDate === null || vacation.price === undefined) {\r\n            alert('please fix all inputs / enter valid values .');\r\n            return;\r\n        }\r\n\r\n        this.sendForm();\r\n    }\r\n\r\n    private sendForm = () => {\r\n        const vacation = { ...this.state.vacation };\r\n        const formData = new FormData();\r\n        formData.append('image', this.state.newImage)\r\n        formData.append('vacation', JSON.stringify(vacation))\r\n\r\n        const options = {\r\n            method: \"PUT\",\r\n            headers: {\r\n                \"Authorization\": \"Bearer \" + localStorage.getItem('token')\r\n            },\r\n            body: formData\r\n        };\r\n\r\n        fetch('http://localhost:3001/api/vacations/update-vacation', options)\r\n            .then(res => res.json())\r\n            .then(vacation => {\r\n                const action: Action = {\r\n                    type: ActionType.updateVacation,\r\n                    payload: vacation\r\n                };\r\n                store.dispatch(action);\r\n\r\n                alert('vacation has been updated !');\r\n                this.props.history.push(\"/admin-panel\");\r\n                this.socket.emit(\"get-all-vacations\");\r\n            })\r\n            .catch(err => alert(err));\r\n\r\n    }\r\n    public render(): JSX.Element {\r\n        return (\r\n            <div className='editVacation'>\r\n                {this.state.user.isAdmin ?\r\n                    <form>\r\n                        <table>\r\n                            <tbody>\r\n                                <tr>\r\n                                    <td>\r\n                                        <p>destination :</p>\r\n                                    </td>\r\n                                    <td>\r\n                                        <TextField value={this.state.vacation.destination || ''} variant=\"filled\"\r\n                                            onChange={this.updateDestination}\r\n                                            helperText=\"Type between 3-50 characters\"\r\n                                        />\r\n                                    </td>\r\n                                    <td>\r\n                                        <p>description : </p>\r\n                                    </td>\r\n                                    <td>\r\n                                        <TextField\r\n                                            value={this.state.vacation.description || ''}\r\n                                            multiline\r\n                                            helperText=\"Type between 4-300 characters\"\r\n                                            onChange={this.updateDescription}\r\n                                        />\r\n                                    </td>\r\n                                </tr>\r\n\r\n                                <tr>\r\n                                    <td>\r\n                                        <p>Departing : </p>\r\n                                    </td>\r\n                                    <td>\r\n                                        <MuiPickersUtilsProvider utils={DateFnsUtils}>\r\n                                            <Grid container justify=\"space-around\">\r\n                                                <KeyboardDatePicker\r\n                                                    margin=\"normal\"\r\n                                                    format=\"dd/MM/yyyy\"\r\n                                                    value={this.state.vacation.fromDate}\r\n                                                    onChange={this.updateDepartingDate}\r\n                                                    KeyboardButtonProps={{\r\n                                                        'aria-label': 'change date',\r\n                                                    }}\r\n                                                />\r\n                                            </Grid>\r\n                                        </MuiPickersUtilsProvider>\r\n                                    </td>\r\n                                    <td>\r\n                                        <p>Returning : </p>\r\n                                    </td>\r\n                                    <td>\r\n                                        <MuiPickersUtilsProvider utils={DateFnsUtils}>\r\n                                            <Grid container justify=\"space-around\">\r\n                                                <KeyboardDatePicker\r\n                                                    margin=\"normal\"\r\n                                                    format=\"dd/MM/yyyy\"\r\n                                                    value={this.state.vacation.toDate}\r\n                                                    onChange={this.updateReturningDate}\r\n                                                    KeyboardButtonProps={{\r\n                                                        'aria-label': 'change date',\r\n                                                    }}\r\n                                                />\r\n                                            </Grid>\r\n                                        </MuiPickersUtilsProvider>\r\n                                    </td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td>\r\n                                        <p>Price : </p>\r\n                                    </td>\r\n                                    <td>\r\n                                        <TextField label=\"price\" value={this.state.vacation.price || ''}\r\n                                            variant=\"filled\"\r\n                                            helperText=\"Type between 1-6 characters\"\r\n                                            onChange={this.updatePrice} />\r\n                                    </td>\r\n                                    <td>\r\n                                        <p>Image : </p>\r\n                                    </td>\r\n                                    <td><img src={`/assets/images/vacations/${this.state.imgToDisplay}`} alt='old' /></td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td></td>\r\n                                    <td></td>\r\n                                    <td></td>\r\n                                    <td>\r\n                                        <input\r\n                                            accept=\"image/*\"\r\n                                            className=\"imageUplode\"\r\n                                            id=\"outlined-button-file\"\r\n                                            multiple\r\n                                            type=\"file\"\r\n                                            name=\"imageToUplode\"\r\n                                            onChange={this.checkImage}\r\n                                        />\r\n                                        <label htmlFor=\"outlined-button-file\">\r\n                                            <Button variant=\"outlined\" component=\"span\">\r\n                                                Upload new image\r\n                                             </Button>\r\n                                        </label>\r\n                                    </td>\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                        <hr />\r\n                        <Button variant=\"contained\" color=\"primary\" onClick={() => this.props.history.push(\"/admin-panel\")}>\r\n                            Cancel\r\n                        </Button>\r\n                        <Button variant=\"contained\" color=\"secondary\" onClick={this.checkForm}>\r\n                            Update Vacation\r\n                      </Button>\r\n                    </form>\r\n                    : <PageNotFound />\r\n                }\r\n            </div >\r\n        );\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}